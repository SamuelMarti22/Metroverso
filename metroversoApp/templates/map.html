{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />

    <!--MapBox imports-->
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v3.13.0/mapbox-gl.css"
      rel="stylesheet"
    />
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.13.0/mapbox-gl.js"></script>

    <!--Turf import-->
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

    <!--CSS/style imports-->
    <link rel="stylesheet" href="{% static 'css/Stylemap.css' %}" />

    <!--JS/js-->
    <script>
      // Configuration for the application
      window.APP_CONFIG = {
        geojsonUrl: "{% static 'geojson/Lineas_Sistema_Metro.geojson' %}"
      };
    </script>
    <script
      src="{% static 'js/dataTurf.js' %}"
      onload="console.log('dataTurf cargado');"
    ></script>
    <script
      src="{% static 'js/functions.js' %}"
      onload="console.log('functions cargado');"
    ></script>

    <!-- Bootstrap JS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </head>

  <body>
    <!--Map Container-->
    <div id="map"></div>

    <!-- Validation alert -->
    <div
      id="alerta-validacion"
      class="alert alert-warning alert-dismissible fade show position-absolute top-0 start-50 translate-middle-x mt-3"
      role="alert"
      style="display: none; z-index: 9999; max-width: 600px"
    >
      <span id="mensaje-alerta">Mensaje de alerta aquí</span>
    </div>

    <!-- Sidebar -->
    <div class="sidebar d-flex flex-column">
      <div class="icon d-flex justify-content-center align-items-center">
        <img
          src="{% static 'images/LogoB.png' %}"
          alt="Metroverso Logo"
          width="55"
          height="55"
          style="border-radius: 8px"
        />
      </div>

      <div
        class="subCategory d-flex justify-content-center align-items-center active"
        type="button"
        data-bs-toggle="offcanvas"
        data-bs-target="#offcanvasScrolling"
        aria-controls="offcanvasScrolling"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          fill="currentColor"
          class="bi bi-compass-fill"
          viewBox="0 0 16 16"
        >
          <path
            d="M15.5 8.516a7.5 7.5 0 1 1-9.462-7.24A1 1 0 0 1 7 0h2a1 1 0 0 1 .962 1.276 7.5 7.5 0 0 1 5.538 7.24m-3.61-3.905L6.94 7.439 4.11 12.39l4.95-2.828 2.828-4.95z"
          />
        </svg>
      </div>

      <div class="subCategory d-flex justify-content-center align-items-center">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          fill="currentColor"
          class="bi bi-signpost-2-fill"
          viewBox="0 0 16 16"
        >
          <path
            d="M7.293.707A1 1 0 0 0 7 1.414V2H2a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h5v1H2.5a1 1 0 0 0-.8.4L.725 8.7a.5.5 0 0 0 0 .6l.975 1.3a1 1 0 0 0 .8.4H7v5h2v-5h5a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1H9V6h4.5a1 1 0 0 0 .8-.4l.975-1.3a.5.5 0 0 0 0-.6L14.3 2.4a1 1 0 0 0-.8-.4H9v-.586A1 1 0 0 0 7.293.707"
          />
        </svg>
      </div>

      <div class="subCategory d-flex justify-content-center align-items-center">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          fill="currentColor"
          class="bi bi-radar"
          viewBox="0 0 16 16"
        >
          <path
            d="M6.634 1.135A7 7 0 0 1 15 8a.5.5 0 0 1-1 0 6 6 0 1 0-6.5 5.98v-1.005A5 5 0 1 1 13 8a.5.5 0 0 1-1 0 4 4 0 1 0-4.5 3.969v-1.011A2.999 2.999 0 1 1 11 8a.5.5 0 0 1-1 0 2 2 0 1 0-2.5 1.936v-1.07a1 1 0 1 1 1 0V15.5a.5.5 0 0 1-1 0v-.518a7 7 0 0 1-.866-13.847"
          />
        </svg>
      </div>

      <div
        class="subCategory d-flex justify-content-center align-items-center"
        type="button"
        data-bs-toggle="offcanvas"
        data-bs-target="#languageOffcanvas"
        aria-controls="languageOffcanvas"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          fill="currentColor"
          class="bi bi-translate"
          viewBox="0 0 16 16"
        >
          <path
            d="M4.545 6.714 4.11 8H3l1.862-5h1.284L8 8H6.833l-.435-1.286zm1.634-.736L5.5 3.956h-.049l-.679 2.022z"
          />
          <path
            d="M0 2a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v3h3a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-3H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zm7.138 9.995q.289.451.63.846c-.748.575-1.673 1.001-2.768 1.292.178.217.451.635.555.867 1.125-.359 2.08-.844 2.886-1.494.777.665 1.739 1.165 2.93 1.472.133-.254.414-.673.629-.89-1.125-.253-2.057-.694-2.82-1.284.681-.747 1.222-1.651 1.621-2.757H14V8h-3v1.047h.765c-.318.844-.74 1.546-1.272 2.13a6 6 0 0 1-.415-.492 2 2 0 0 1-.94.31"
          />
        </svg>
      </div>

      <div class="profileIcon d-flex justify-content-center align-items-center">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          fill="white"
          class="bi bi-person-fill"
          viewBox="0 0 16 16"
        >
          <path
            d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"
          />
        </svg>
      </div>
    </div>

    <!-- Offcanvas Panel -->
    <div class="offcanvasContainer">
      <div
        class="offcanvas offcanvas-start"
        data-bs-scroll="true"
        data-bs-backdrop="false"
        tabindex="-1"
        id="offcanvasScrolling"
        aria-labelledby="offcanvasScrollingLabel"
      >
        <div class="offcanvas-header border-bottom">
          <h5
            class="offcanvas-title text-success fw-bold"
            id="offcanvasScrollingLabel"
          >
            Planificador de Rutas Metro
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="offcanvas"
            aria-label="Close"
          ></button>
        </div>
        <div class="offcanvas-body">
          <div class="divRute">
            <div class="mb-3">
              <label for="inputStart" class="form-label text-muted small"
                >Estación de Inicio</label
              >
              <input
                type="text"
                class="form-control"
                id="inputStart"
                placeholder="Inicio"
                autocomplete="off"
              />
            </div>
            <div class="mb-3">
              <label for="inputDestination" class="form-label text-muted small"
                >Estación de Destino</label
              >
              <input
                type="text"
                class="form-control"
                id="inputDestination"
                placeholder="Destino"
                autocomplete="off"
              />
            </div>
            

            <button
              class="btn btn-primary w-100 fw-semibold"
              id="btnSearchRute"
            >
              <i class="bi bi-search me-2"></i>Buscar Ruta
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Language Offcanvas Panel -->
    <div class="languageContainer">
      <div
        class="offcanvas offcanvas-start"
        data-bs-scroll="true"
        data-bs-backdrop="false"
        tabindex="-1"
        id="languageOffcanvas"
        aria-labelledby="languageOffcanvasLabel"
      >
        <div class="offcanvas-header border-bottom">
          <h5
            class="offcanvas-title text-success fw-bold"
            id="languageOffcanvasLabel"
          >
            Seleccionar Idioma
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="offcanvas"
            aria-label="Close"
          ></button>
        </div>
        <div class="offcanvas-body">
          <div class="language-list">
            <div class="language-item selected" data-lang="es">
              <div
                class="language-flag"
                style="
                  background: linear-gradient(
                    to bottom,
                    #aa151b 0%,
                    #aa151b 33.33%,
                    #f1bf00 33.33%,
                    #f1bf00 66.66%,
                    #aa151b 66.66%,
                    #aa151b 100%
                  );
                "
              ></div>
              <span>Español</span>
              <i class="bi bi-check-circle-fill ms-auto text-success"></i>
            </div>
            <div class="language-item" data-lang="en">
              <div
                class="language-flag"
                style="
                  background: linear-gradient(
                        135deg,
                        #012169 25%,
                        transparent 25%
                      ) -10px 0,
                    linear-gradient(225deg, #012169 25%, transparent 25%) -10px 0,
                    linear-gradient(315deg, #012169 25%, transparent 25%),
                    linear-gradient(45deg, #012169 25%, transparent 25%);
                  background-size: 20px 20px;
                  background-color: #ffffff;
                  position: relative;
                "
              >
                <div
                  style="
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: repeating-linear-gradient(
                        0deg,
                        #ffffff 0px,
                        #ffffff 2px,
                        #ce1124 2px,
                        #ce1124 4px
                      ),
                      repeating-linear-gradient(
                        90deg,
                        #ffffff 0px,
                        #ffffff 2px,
                        #ce1124 2px,
                        #ce1124 4px
                      );
                  "
                ></div>
                <div
                  style="
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 50%;
                    height: 50%;
                    background: #012169;
                  "
                ></div>
              </div>
              <span>English</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Location Controls Container -->
    <div class="location-controls">
      <!-- Origin Location Button -->
      <div
        class="userLocation1"
        id="btnUserLocationOrigin"
        title="Establecer como punto de inicio"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          fill="currentColor"
          class="bi bi-person-walking"
          viewBox="0 0 16 16"
        >
          <path
            d="M9.5 1.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0M6.44 3.752A.75.75 0 0 1 7 3.5h1.445c.742 0 1.32.643 1.243 1.38l-.43 4.083a1.8 1.8 0 0 1-.088.395l-.318.906.213.242a.8.8 0 0 1 .114.175l2 4.25a.75.75 0 1 1-1.357.638l-1.956-4.154-1.68-1.921A.75.75 0 0 1 6 8.96l.138-2.613-.435.489-.464 2.786a.75.75 0 1 1-1.48-.246l.5-3a.75.75 0 0 1 .18-.375l2-2.25Z"
          />
          <path
            d="M6.25 11.745v-1.418l1.204 1.375.261.524a.8.8 0 0 1-.12.231l-2.5 3.25a.75.75 0 1 1-1.19-.914zm4.22-4.215-.494-.494.205-1.843.006-.067 1.124 1.124h1.44a.75.75 0 0 1 0 1.5H11a.75.75 0 0 1-.531-.22Z"
          />
        </svg>
      </div>

      <!-- Destination Location Button -->
      <div
        class="userLocation2"
        id="btnUserLocationDestiny"
        title="Establecer como destino"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          fill="currentColor"
          class="bi bi-person-standing"
          viewBox="0 0 16 16"
        >
          <path
            d="M8 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3M6 6.75v8.5a.75.75 0 0 0 1.5 0V10.5a.5.5 0 0 1 1 0v4.75a.75.75 0 0 0 1.5 0v-8.5a.25.25 0 1 1 .5 0v2.5a.75.75 0 0 0 1.5 0V6.5a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v2.75a.75.75 0 0 0 1.5 0v-2.5a.25.25 0 0 1 .5 0"
          />
        </svg>
      </div>

      <!-- Current Location Button -->
      <div class="userLocation" title="Mi ubicación">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          fill="green"
          class="bi bi-person-arms-up"
          viewBox="0 0 16 16"
        >
          <path d="M8 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" />
          <path
            d="m5.93 6.704-.846 8.451a.768.768 0 0 0 1.523.203l.81-4.865a.59.59 0 0 1 1.165 0l.81 4.865a.768.768 0 0 0 1.523-.203l-.845-8.451A1.5 1.5 0 0 1 10.5 5.5L13 2.284a.796.796 0 0 0-1.239-.998L9.634 3.84a.7.7 0 0 1-.33.235c-.23.074-.665.176-1.304.176-.64 0-1.074-.102-1.305-.176a.7.7 0 0 1-.329-.235L4.239 1.286a.796.796 0 0 0-1.24.998l2.5 3.216c.317.316.475.758.43 1.204Z"
          />
        </svg>
      </div>
    </div>

    <!-- Closest station buttons -->
    <div
      class="position-absolute top-0 end-0 m-3"
      id="closestStationsBox"
      style="z-index: 1050; display: none"
    >
      <div
        class="bg-white border rounded shadow p-2 d-flex flex-column align-items-center"
        style="width: 120px"
      >
        <button
          type="button"
          class="btn btn-outline-success btn-sm w-100 mb-2"
          id="btnUserLocation"
          title="Mi ubicación"
        >
          <i class="bi bi-person"></i>
        </button>
        <button
          type="button"
          class="btn btn-outline-primary btn-sm w-100 mb-2"
          id="btnClosestStation1"
          title="Estación más cercana 1"
        >
          <i class="bi bi-geo-alt"></i>
        </button>
        <button
          type="button"
          class="btn btn-outline-danger btn-sm w-100 mb-2"
          id="btnClosestStation2"
          title="Estación más cercana 2"
        >
          <i class="bi bi-geo-alt"></i>
        </button>
        <button
          type="button"
          class="btn btn-outline-warning btn-sm w-100"
          id="btnClosestStation3"
          title="Estación más cercana 3"
        >
          <i class="bi bi-geo-alt"></i>
        </button>
      </div>
    </div>

    <script src="{% static 'js/mapScript.js' %}"></script>
  </body>
</html>
